!function(e){e.fn.dynamicrows=function(t){function o(t){var o=e(t).closest(d.row);if(d.beforeAdd){var r=d.beforeAdd(o);if(r===!1)return!1}if(d.beforeAll){var r=d.beforeAll(o);if(r===!1)return!1}if(d.copyRow)var i=e(t).closest(d.rows).find(d.row+":nth-child("+d.copyRow+")").clone(!0);else var i=o.clone(!0);return 0==i.length?!1:(l(i,!0),d.copyValues&&n(o,i),e.fn.datepick&&e("input.datepicker",i).datepick("destroy").datepick(),i.insertAfter(o),a(),d.afterAdd&&d.afterAdd(i),void(d.afterAll&&d.afterAll(i)))}function r(t){var o=e(t).closest(d.row);if(d.beforeRemove){var r=d.beforeRemove(o);if(r===!1)return!1}if(d.beforeAll){var r=d.beforeAll(o);if(r===!1)return!1}var n=e(o).closest(d.rows),i=e("> "+d.row,n).length;i>d.minrows?(o.remove(),a(),o=null):l(o),d.afterRemove&&d.afterRemove(o),d.afterAll&&d.afterAll(o)}function a(){var t=/(.*?)(\[\d+?\])(?!\[\d+?\])(.*)/g,o=d.index_start-1;e("> "+d.row,d.rows).each(function(){var r=e(this);d.beforeFormUpdateNames&&d.beforeFormUpdateNames(r),o++,r.find(":input").each(function(){e(this).attr("name",function(e,r){return void 0===r?!0:r.replace(t,function(e,t,r,a){return t+"["+o+"]"+a})}).removeAttr("id")}),d.increment&&r.find(d.increment).html(o+1),d.afterFormUpdateNames&&d.afterFormUpdateNames(r)})}function n(t,o){t.find(":text, textarea, select:not(multiple)").each(function(){var t=e(this),r=t.attr("name");o.find('[name="'+r+'"]').val(t.val())}),t.find(":checkbox, :radio").each(function(){var t=e(this),r=t.attr("name");o.find('[name="'+r+'"]').prop("checked",t.prop("checked"))})}function l(t,o){e(".disabled",t).removeClass("disabled"),e('input[type="hidden"]',t).val(""),o&&d.copyValues!==!1||(e(":text, textarea",t).val(""),e(":checkbox, :radio",t).prop("checked",!1),e("select option",t).removeAttr("selected").find(":first").prop("selected",!0))}var i=e(this),d=e.extend({row:"tr",rows:"tbody",minrows:1,copyRow:null,copyValues:!1,increment:null,handle_add:"[data-add]:not(.disabled)",handle_remove:"[data-remove]:not(.disabled)",handle_move:"[data-move]:not(.disabled)",index_start:0,beforeAdd:null,beforeRemove:null,beforeMove:null,beforeFormUpdateNames:null,beforeAll:null,afterAdd:null,afterRemove:null,afterMove:null,afterFormUpdateNames:null,afterAll:null},t),f=i.data();if("object"==typeof f&&e.each(f,function(e,t){"undefined"!=typeof d[e]&&("string"==typeof t&&0==t.length&&(t=!0),d[e]=t)}),d.rows=e(d.rows,this),d.handle_add&&i.on("click",d.handle_add,function(e){e.preventDefault(),o(this)}),d.handle_remove&&i.on("click",d.handle_remove,function(e){e.preventDefault(),r(this)}),d.handle_move&&e(d.handle_move,d.rows).length>0)if("undefined"!=typeof Sortable){var s=e(d.rows,this)[0];e(d.handle_move,d.rows).each(function(){var t=e(this).closest(d.row);t.addClass("dynamicrows-row"),t.find(d.handle_move).addClass("dynamicrows-move")});new Sortable(s,{handle:".dynamicrows-move",draggable:".dynamicrows-row",onStart:function(e){d.beforeMove&&d.beforeMove(e.item),d.beforeAll&&d.beforeAll(e.item)},onUpdate:function(e){a(),d.afterMove&&d.afterMove(e.item),d.afterAll&&d.afterAll(e.item)}})}else if(jQuery.fn.sortable){var c=[];e(d.handle_move,d.rows).each(function(){c.push(e(this).closest(d.row))}),e(d.rows,this).sortable({items:c,handle:d.handle_move,start:function(e,t){d.beforeMove&&d.beforeMove(t.item),d.beforeAll&&d.beforeAll(t.item)},update:function(e,t){a(),d.afterMove&&d.afterMove(t.item),d.afterAll&&d.afterAll(t.item)}})}else alert("No sortable-plugin found! Please load sortablejs or jquery-ui (with sortable widget).")}}(jQuery);